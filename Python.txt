<?php
require 'vendor/autoload.php';

use PhpOffice\PhpSpreadsheet\Spreadsheet;
use PhpOffice\PhpSpreadsheet\Writer\Xlsx;

class ExportarExcel {
    public function generarExcel($namefile = 'reporte.xlsx') {
        // Datos de ejemplo
        $datos = [
            ['ID', 'Nombre', 'Edad'],
            [1, 'Juan', 25],
            [2, 'Ana', 30],
            [3, 'Carlos', 28]
        ];

        // Crear documento Excel
        $spreadsheet = new Spreadsheet();
        $sheet = $spreadsheet->getActiveSheet();

        // Llenar con datos
        foreach ($datos as $fila => $filaDatos) {
            foreach ($filaDatos as $col => $valor) {
                $sheet->setCellValueByColumnAndRow($col + 1, $fila + 1, $valor);
            }
        }

        // Asegurar que el nombre del archivo tenga la extensiÃ³n .xlsx
        if (!str_ends_with($namefile, '.xlsx')) {
            $namefile .= '.xlsx';
        }

        // Configurar encabezados para descargar con el nombre personalizado
        header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
        header("Content-Disposition: attachment; filename=\"$namefile\"");
        header('Cache-Control: max-age=0');

        // Generar y enviar el archivo
        $writer = new Xlsx($spreadsheet);
        $writer->save('php://output');
        exit;
    }
}

// Obtener el nombre del archivo desde GET o usar el predeterminado
$namefile = isset($_GET['name']) ? $_GET['name'] : 'reporte.xlsx';

// Ejecutar la descarga
$exportador = new ExportarExcel();
$exportador->generarExcel($namefile);