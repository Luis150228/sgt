export const processMailFileCom = (frmTablero) => {
    return new Promise((resolve, reject) => {
        const frm = document.getElementById(`${frmTablero}`);
        const input = frm.querySelector('input');
        const rangeInput = 'A1:G49';
        const rangeCarrierOut = 'B13:F18';

        if (!input.files.length || !rangeInput) {
            alert('Selecciona un archivo Excel y especifica un rango.');
            reject('No se seleccionÃ³ archivo o rango.');
            return;
        }

        const reader = new FileReader();
        reader.onload = (event) => {
            try {
                const data = new Uint8Array(event.target.result);
                const workbook = XLSX.read(data, { type: 'array' });

                const sheetName = workbook.SheetNames[0];
                const sheet = workbook.Sheets[sheetName];

                const range = XLSX.utils.decode_range(rangeCarrierOut);
                const filteredSheet = filterEmptyCells(sheet, range);
                const htmlTable = XLSX.utils.sheet_to_html(filteredSheet);
                const divCarrier = document.createElement('div');
                divCarrier.innerHTML = htmlTable;

                const tbodyCarrierNew = divCarrier.querySelector('tbody');
                const tbodyCarrier = document.getElementById('data-carriers');
                tbodyCarrier.innerHTML = tbodyCarrierNew.innerHTML;

                const jsonDataTypeInc = XLSX.utils.sheet_to_json(sheet, {
                    range: 'E7:F11',
                    header: ['type', 'valor'],
                });
                const cellsIncType = document.querySelectorAll('.data-typeInc');
                for (const [i, cellIncType] of cellsIncType.entries()) {
                    cellsIncType[i].innerHTML = jsonDataTypeInc[i].valor;
                }

                const cellContingencia = document.getElementById('contingencia');
                const totalLentitud = jsonDataTypeInc[jsonDataTypeInc.length - 1].valor;
                const totalBackup = jsonDataTypeInc[jsonDataTypeInc.length - 2].valor;
                cellContingencia.innerHTML = totalLentitud + totalBackup;

                const jsonDataCommits = XLSX.utils.sheet_to_json(sheet, {
                    range: 'B48:F48',
                    header: ['valor'],
                });

                const jsonSucFuera = jsonDataCommits[0].valor.trim().split('\r\n');
                const sucOff = document.getElementById('suc-off');
                const sucOffCommit = document.getElementById('sucFuera');
                sucOff.innerHTML = jsonSucFuera.length;
                sucOffCommit.innerHTML = `${jsonSucFuera.join('; ')}`;

                const container = document.getElementById('tableContainer');
                const tablaSaves = container.innerHTML;

                const tablaSave = {
                    code: '200',
                    mnj: 'Datos Procesados',
                    data: [
                        {
                            total: 1,
                            actualizado: new Date().toISOString(),
                            type: 'tablero',
                        },
                    ],
                    tabla: tablaSaves,
                };

                resolve(tablaSave); // Resuelve la promesa con los datos procesados
            } catch (error) {
                reject(error); // Rechaza la promesa en caso de error
            }
        };

        reader.readAsArrayBuffer(input.files[0]);
    });
};
