<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Excel Table Preview</title>
    <style>
        .titleImagen {
            font-size: 16px;
            padding-top: 1rem;
        }

        .generado {
            font-size: 10px;
        }

        .sgtMexRed {
            color: red;
            font-size: 12px;
        }

        .table-rep13-headers {
            width: 100%;
            max-width: 800px;
            margin: 20px auto;
            font-family: Arial, sans-serif;
            text-align: center;
            /* padding-bottom: 1rem; */
        }

        .table-rep13 {
            border-collapse: collapse;
            border: 8px solid #616161;
            width: 100%;
            max-width: 800px;
            margin: 2px auto;
            font-family: Arial, sans-serif;
            text-align: center;
        }

        .table-rep13-into {
            font-size: 13px;
            border: 1px solid #fff8f8;
            background-color: #b4aeae;

        }

        .tituloSeccion {
            border: 1px solid #fff8f8;
            background-color: #616161;
            color: white;
            font-size: 16px;
            font-weight: bolder;
            padding: 0.5rem;
        }

        .table-rep13-into-sbTitle {
            border: 1px solid #fff8f8;
            background-color: #616161;
            color: white;
            font-size: 16px;
            padding: 0.2rem;
        }

        .table-rep13-into-sbTitle td {
            border: 1px solid #fff8f8;
            background-color: #616161;
            color: white;
            font-size: 16px;
            padding: 0.2rem;
        }

        .table-rep13-into-sbTitle-sm td {
            border: 1px solid #fff8f8;
            background-color: #616161;
            color: white;
            font-size: 14px;
            padding: 0.1rem;
        }

        .table-rep13-into-commit td {
            font-size: 12px;
            border: 1px solid #fff8f8;
            background-color: #fff8f8;
            height: 150px;
        }

        .one-line {
            display: flex;
        }

        .table-rep13-border td {
            background-color: #878787;

        }

        .table-rep13 tr:nth-child(odd) {
            background-color: #b4aeae;
            border: 1px solid #616161;
        }

        .table-rep13 tr:nth-child(even) {
            background-color: #ebebeb;
            border: 1px solid #616161;
        }

        .table-rep13 td:nth-child(odd) {
            border: 1px solid white;
        }

        .table-rep13 td:nth-child(even) {
            border: 1px solid white;
        }

        .onTime {
            display: inline-block;
            height: 12px;
            width: 12px;
            border-radius: 50%;
            background-color: greenyellow;
        }

        .outTime {
            display: inline-block;
            height: 12px;
            width: 12px;
            border-radius: 50%;
            background-color: red;
        }

        .timer-line {
            height: 30px;
        }

        .img-pais {
            height: 50px;
            width: 60px;
            border-radius: 50%;
        }

        .img-empresa {
            height: 50px;
            width: 60px;
        }
    </style>
</head>

<body>
    <div id="controls">
        <input type="file" id="excelFile" accept=".xlsx, .xls" />
        <!-- <input type="text" id="rangeInput" placeholder="Ejemplo: A1:D10" /> -->
        <button id="previewTable">Previsualizar Tabla</button>
        <button id="generateImage" style="display: none;">Generar Imagen</button>
    </div>
    <div id="tableContainer">
        <table id="styledTable-title" class="table-rep13-headers">
            <tbody>
                <tr>
                    <td rowspan="3"><img class="img-pais" src="../assets/img/Flag_of_Mexico.svg.png" alt="pais"></td>
                    <td class="titleImagen" colspan="3">SEGUIMIENTO A SUCURSALES</td>
                    <td rowspan="3"><img class="img-empresa" src="../assets/img/Banco_Santander_LogotipoSmall.svg"
                            alt="santander"></td>
                </tr>
                <tr>
                    <td class="generado" colspan="3">08:00 HRS - Tuesday 21 de January</td>
                </tr>
                <tr>
                    <td class="sgtMexRed" colspan="3">SGT México</td>
                </tr>
                <tr>
                    <td colspan="5"></td>
                </tr>
            </tbody>
        </table>

        <table id="styledTable-comunicaciones" class="table-rep13">
            <tbody>
                <tr class="table-rep13-into" id="data-comunicaciones">
                    <td colspan="5" class="tituloSeccion">COMUNICACIONES</td>
                </tr>
                <tr class="table-rep13-into">
                    <td class="table-rep13-into-sbTitle" rowspan="2">Total de oficinas:</td>
                    <td colspan="2">Total Off:</td>
                    <td>Servidor</td>
                    <td id="servidor">0</td>
                </tr>
                <tr class="table-rep13-into">
                    <td colspan="2" rowspan="2">0</td>
                    <td>Comunicaciones</td>
                    <td id="comunicaciones">0</td>
                </tr>
                <tr class="table-rep13-into">
                    <td id="suc-total" class="table-rep13-into-sbTitle" rowspan="3">1,323</td>
                    <td>Energía E.</td>
                    <td id="energia">0</td>
                </tr>
                <tr class="table-rep13-into">
                    <td colspan="2">Contingencia:</td>
                    <td>Backup</td>
                    <td id="backup">3</td>
                </tr>
                <tr class="table-rep13-into">
                    <td colspan="2">3</td>
                    <td>Lentitud</td>
                    <td id="lentitud">0</td>
                </tr>
            </tbody>
        </table>
        <table id="styledTable-comunicaciones" class="table-rep13">
            <thead>
                <tr class="table-rep13-into">
                    <td class="table-rep13-into-sbTitle" colspan="5">Carriers con problemas</td>
                </tr>
            </thead>
            <tbody id="data-carriers">
                <tr id="carriers-titles-a" class="table-rep13-into">
                    <td data-v="Telmex">Telmex</td>
                    <td data-v="Iusacell">Iusacell</td>
                    <td data-v="Telcel">Telcel</td>
                    <td data-v="Izzi">Izzi</td>
                    <td data-v="Metrocarrier">Metrocarrier</td>
                </tr>
                <tr id="carriers-data-a" class="table-rep13-into">
                    <td>0</td>
                    <td>0</td>
                    <td>0</td>
                    <td>0</td>
                    <td>0</td>
                </tr>
                <tr id="carriers-titles-b" class="table-rep13-into">
                    <td data-v="Telefónica">Telefónica</td>
                    <td data-v="Axtel">Axtel</td>
                    <td data-v="Totalplay">Totalplay</td>
                    <td data-v="SDWAN">SDWAN</td>
                    <td data-v="FUNO">FUNO</td>
                </tr>
                <tr id="carriers-data-b" class="table-rep13-into">
                    <td>0</td>
                    <td>0</td>
                    <td>0</td>
                    <td>0</td>
                    <td>0</td>
                </tr>
                <tr id="carriers-titles-c" class="table-rep13-into">
                    <td data-v="Cliente">Cliente</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr id="carriers-data-c" class="table-rep13-into">
                    <td>0</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
            </tbody>
        </table>
        <table id="incidentes-sh-content" class="table-rep13">
            <thead>
                <tr class="table-rep13-into">
                    <td colspan="5" class="tituloSeccion">INCIDENTES SERVICENOW Service Desk y WhatsApp</td>
                </tr>
                <tr class="table-rep13-into-sbTitle">
                    <td rowspan="2">Región</td>
                    <td colspan="2">Software</td>
                    <td colspan="2">Hardware</td>
                </tr>
                <tr class="table-rep13-into-sbTitle-sm timer-line">
                    <td>En Tiempo <span class="onTime"></span></td>
                    <td>Vencidos <span class="outTime"></span></td>
                    <td>En Tiempo <span class="onTime"></span></td>
                    <td>Vencidos <span class="outTime"></span></td>
                </tr>
            </thead>
            <tbody id="data-incidentes">
                <tr class="table-rep13-into">
                    <td data-v="Centro">Centro</td>
                    <td>0</td>
                    <td>0</td>
                    <td>0</td>
                    <td>0</td>
                </tr>
                <tr class="table-rep13-into">
                    <td data-v="Metro Norte">Metro Norte</td>
                    <td>0</td>
                    <td>0</td>
                    <td>0</td>
                    <td>0</td>
                </tr>
                <tr class="table-rep13-into">
                    <td data-v="Metro Sur">Metro Sur</td>
                    <td>0</td>
                    <td>0</td>
                    <td>0</td>
                    <td>0</td>
                </tr>
                <tr class="table-rep13-into">
                    <td data-v="Norte">Norte</td>
                    <td>0</td>
                    <td>0</td>
                    <td>0</td>
                    <td>0</td>
                </tr>
                <tr class="table-rep13-into">
                    <td data-v="Noreste">Noreste</td>
                    <td>0</td>
                    <td>0</td>
                    <td>0</td>
                    <td>0</td>
                </tr>
                <tr class="table-rep13-into">
                    <td data-v="Noroeste">Noroeste</td>
                    <td>0</td>
                    <td>0</td>
                    <td>0</td>
                    <td>0</td>
                </tr>
                <tr class="table-rep13-into">
                    <td data-v="Occidente">Occidente</td>
                    <td>0</td>
                    <td>0</td>
                    <td>0</td>
                    <td>0</td>
                </tr>
                <tr class="table-rep13-into">
                    <td data-v="Sur">Sur</td>
                    <td>0</td>
                    <td>0</td>
                    <td>0</td>
                    <td>0</td>
                </tr>
                <tr class="table-rep13-into">
                    <td data-v="Sureste">Sureste</td>
                    <td>0</td>
                    <td>0</td>
                    <td>0</td>
                    <td>0</td>
                </tr>
                <tr class="table-rep13-into-sbTitle">
                    <td data-v="Total">Total</td>
                    <td>0</td>
                    <td>0</td>
                    <td>0</td>
                    <td>0</td>
                </tr>
                <tr class="table-rep13-into">
                    <td colspan="5"></td>
                </tr>
            </tbody>
        </table>
        <table class="table-rep13">
            <thead>
                <tr class="table-rep13-into-sbTitle">
                    <td rowspan="2">Región</td>
                    <td colspan="2">Comunicaciones</td>
                    <td colspan="2">Multifuncionales</td>
                </tr>
                <tr class="table-rep13-into-sbTitle-sm">
                    <td>En Tiempo <span class="onTime"></span></td>
                    <td>Vencidos <span class="outTime"></span></td>
                    <td>En Tiempo <span class="onTime"></span></td>
                    <td>Vencidos <span class="outTime"></span></td>
                </tr>
            </thead>
            <tbody id="incidentes-cm-content">
                <tr class="table-rep13-into">
                    <td data-v="Centro">Centro</td>
                    <td>0</td>
                    <td>0</td>
                    <td>0</td>
                    <td>0</td>
                </tr>
                <tr class="table-rep13-into">
                    <td data-v="Metro Norte">Metro Norte</td>
                    <td>0</td>
                    <td>0</td>
                    <td>0</td>
                    <td>0</td>
                </tr>
                <tr class="table-rep13-into">
                    <td data-v="Metro Sur">Metro Sur</td>
                    <td>0</td>
                    <td>0</td>
                    <td>0</td>
                    <td>0</td>
                </tr>
                <tr class="table-rep13-into">
                    <td data-v="Norte">Norte</td>
                    <td>0</td>
                    <td>0</td>
                    <td>0</td>
                    <td>0</td>
                </tr>
                <tr class="table-rep13-into">
                    <td data-v="Noreste">Noreste</td>
                    <td>0</td>
                    <td>0</td>
                    <td>0</td>
                    <td>0</td>
                </tr>
                <tr class="table-rep13-into">
                    <td data-v="Noroeste">Noroeste</td>
                    <td>0</td>
                    <td>0</td>
                    <td>0</td>
                    <td>0</td>
                </tr>
                <tr class="table-rep13-into">
                    <td data-v="Occidente">Occidente</td>
                    <td>0</td>
                    <td>0</td>
                    <td>0</td>
                    <td>0</td>
                </tr>
                <tr class="table-rep13-into">
                    <td data-v="Sur">Sur</td>
                    <td>0</td>
                    <td>0</td>
                    <td>0</td>
                    <td>0</td>
                </tr>
                <tr class="table-rep13-into">
                    <td data-v="Sureste">Sureste</td>
                    <td>0</td>
                    <td>0</td>
                    <td>0</td>
                    <td>0</td>
                </tr>
                <tr class="table-rep13-into-sbTitle">
                    <td data-v="Total">Total</td>
                    <td>0</td>
                    <td>0</td>
                    <td>0</td>
                    <td>0</td>
                </tr>
                <tr class="table-rep13-into">
                    <td colspan="5"></td>
                </tr>
            </tbody>
        </table>
        <table id="detail-sf" class="table-rep13">
            <thead>
                <tr class="table-rep13-into-sbTitle">
                    <td colspan="5" data-v="Comentarios">Comentarios</td>
                </tr>
            </thead>
            <tbody id="data-commits">
                <tr class="table-rep13-into-commit">
                    <td colspan="5" data-v="sucFuera">1124-KIOSCO TUIIO ACAYUCAN
                        0418-ROSARITO
                        0168-TAMPICO</td>
                </tr>
                <tr class="table-rep13-into">
                    <td colspan="5"></td>
                </tr>
            </tbody>
        </table>
    </div>
    <div id="imageContainer" style="text-align: center;"></div>

    <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas"></script>
    <script>
        document.getElementById('previewTable').addEventListener('click', () => {
            const input = document.getElementById('excelFile');
            const rangeInput = 'A1:G49';
            const rangeCarrierOut = 'B13:F18';
            // const rangeInput = document.getElementById('rangeInput').value.trim();
            if (!input.files.length || !rangeInput) {
                alert('Selecciona un archivo Excel y especifica un rango.');
                return;
            }

            const reader = new FileReader();
            reader.onload = (event) => {
                const data = new Uint8Array(event.target.result);
                const workbook = XLSX.read(data, { type: 'array' });

                // Lee la primera hoja del archivo Excel
                const sheetName = workbook.SheetNames[0];
                const sheet = workbook.Sheets[sheetName];

                // Convierte el rango seleccionado a HTML
                const range = XLSX.utils.decode_range(rangeCarrierOut);
                const filteredSheet = filterEmptyCells(sheet, range);
                const htmlTable = XLSX.utils.sheet_to_html(filteredSheet);
                console.log(htmlTable);

                // Inserta la tabla con estilos
                const container = document.getElementById('tableContainer');
                container.innerHTML = htmlTable;

                const table = container.querySelector('table');
                table.id = 'styledTable';

                // Muestra el botón para generar imagen
                document.getElementById('generateImage').style.display = 'inline-block';
            };

            reader.readAsArrayBuffer(input.files[0]);
        });

        document.getElementById('generateImage').addEventListener('click', () => {
            const container = document.getElementById('tableContainer');
            if (!container.innerHTML) {
                alert('No hay tabla para convertir a imagen.');
                return;
            }

            // Convierte la tabla en imagen
            html2canvas(container).then((canvas) => {
                const link = document.createElement('a');
                link.href = canvas.toDataURL('image/jpeg', 1.0);
                link.download = `table_preview.jpg`;
                link.click();

                // Muestra la imagen generada
                document.getElementById('imageContainer').innerHTML = '';
                document.getElementById('imageContainer').appendChild(canvas);
            });
        });

        // Función para filtrar filas/columnas vacías
        function filterEmptyCells(sheet, range) {
            const newSheet = {};
            for (let R = range.s.r; R <= range.e.r; ++R) {
                for (let C = range.s.c; C <= range.e.c; ++C) {
                    const cellAddress = XLSX.utils.encode_cell({ r: R, c: C });
                    if (sheet[cellAddress] && sheet[cellAddress].v !== undefined) {
                        newSheet[cellAddress] = sheet[cellAddress];
                    }
                }
            }
            newSheet['!ref'] = XLSX.utils.encode_range(range);
            return newSheet;
        }
    </script>
</body>

</html>