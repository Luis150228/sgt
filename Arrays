DELIMITER //
CREATE FUNCTION procesar_fecha(fecha_inicial DATE) RETURNS VARCHAR(100)
BEGIN
    DECLARE dia_semana INT;
    DECLARE fecha_inicio DATE;
    DECLARE fecha_fin DATE;
    DECLARE resultado VARCHAR(100);
    
    SET dia_semana = WEEKDAY(fecha_inicial);
    
    CASE
        WHEN dia_semana = 0 THEN
            SET fecha_inicio = DATE_SUB(fecha_inicial, INTERVAL 2 DAY);
            SET fecha_fin = DATE_ADD(fecha_inicial, INTERVAL 3 DAY);
        WHEN dia_semana = 1 THEN
            SET fecha_inicio = DATE_SUB(fecha_inicial, INTERVAL 4 DAY);
            SET fecha_fin = DATE_ADD(fecha_inicial, INTERVAL 2 DAY);
        WHEN dia_semana = 2 THEN
            SET fecha_inicio = DATE_SUB(fecha_inicial, INTERVAL 5 DAY);
            SET fecha_fin = DATE_ADD(fecha_inicial, INTERVAL 1 DAY);
        WHEN dia_semana = 3 THEN
            SET fecha_inicio = DATE_SUB(fecha_inicial, INTERVAL 6 DAY);
            SET fecha_fin = fecha_inicial;
        WHEN dia_semana = 4 THEN
            SET fecha_inicio = fecha_inicial;
            SET fecha_fin = DATE_ADD(fecha_inicial, INTERVAL 6 DAY);
        WHEN dia_semana = 5 THEN
            SET fecha_inicio = DATE_SUB(fecha_inicial, INTERVAL 1 DAY);
            SET fecha_fin = DATE_ADD(fecha_inicial, INTERVAL 5 DAY);
        WHEN dia_semana = 6 THEN
            SET fecha_inicio = DATE_SUB(fecha_inicial, INTERVAL 2 DAY);
            SET fecha_fin = DATE_ADD(fecha_inicial, INTERVAL 4 DAY);
    END CASE;
    
    SET resultado = CONCAT(
        DAY(fecha_inicio), '/', MONTH(fecha_inicio), ' - ',
        DAY(fecha_fin), '/', MONTH(fecha_fin)
    );
    
    RETURN resultado;
END;
//
DELIMITER ;
