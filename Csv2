require 'vendor/autoload.php';

use PhpOffice\PhpSpreadsheet\Spreadsheet;
use PhpOffice\PhpSpreadsheet\Writer\Xlsx;

// Crear un nuevo objeto de hoja de cálculo
$spreadsheet = new Spreadsheet();
$sheet = $spreadsheet->getActiveSheet();

// Obtener el array de datos que proporcionaste
$data = array(/* ... */); // Tu array de datos aquí

// Filtrar los registros por tipo de solicitud
$incidentesSDK = array_filter($data, function($item) {
    return $item['type'] === 'Incidentes SDK';
});

$incidentesCAU = array_filter($data, function($item) {
    return $item['type'] === 'Incidentes CAU';
});

// Fila de inicio
$row = 9;

// Agregar los encabezados a la primera tabla
$sheet->setCellValue('A' . $row, 'Ticket');
$sheet->setCellValue('B' . $row, 'ID Externo');
$sheet->setCellValue('C' . $row, 'Fecha Envio');
$sheet->setCellValue('D' . $row, 'Fecha Cierre');
// Agregar más encabezados aquí

// Llenar la primera tabla con los datos de Incidentes SDK
$row++;
foreach ($incidentesSDK as $item) {
    $sheet->setCellValue('A' . $row, $item['ticket']);
    $sheet->setCellValue('B' . $row, $item['id_externo']);
    $sheet->setCellValue('C' . $row, $item['fecha_envio']);
    $sheet->setCellValue('D' . $row, $item['fecha_cierre']);
    // Agregar más datos aquí
    $row++;
}

// Dejar una fila de espacio
$row++;

// Agregar los encabezados a la segunda tabla
$sheet->setCellValue('A' . $row, 'Ticket');
$sheet->setCellValue('B' . $row, 'ID Externo');
$sheet->setCellValue('C' . $row, 'Fecha Envio');
$sheet->setCellValue('D' . $row, 'Fecha Cierre');
// Agregar más encabezados aquí

// Llenar la segunda tabla con los datos de Incidentes CAU
$row++;
foreach ($incidentesCAU as $item) {
    $sheet->setCellValue('A' . $row, $item['ticket']);
    $sheet->setCellValue('B' . $row, $item['id_externo']);
    $sheet->setCellValue('C' . $row, $item['fecha_envio']);
    $sheet->setCellValue('D' . $row, $item['fecha_cierre']);
    // Agregar más datos aquí
    $row++;
}

// Guardar la hoja de cálculo en un archivo
$writer = new Xlsx($spreadsheet);
$writer->save('hoja.xlsx');
